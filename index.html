<!doctype html>
	<head>
		<title>Honest Calc</title>
		<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"
				integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
				crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<style>
			input {
				font-family: monospace;
				width: 20em;
			}
			.calc {
				padding: 1em;
			}
		</style>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<a class="navbar-brand" href="/">Honest Calculator</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
				<li class="nav-item">
					<a class="nav-link" href="/about/">about</a>
				</li>
			</div>
		</nav>
		<div class="container">
			<div id="content"></div>
		</div>
		<script src="calculator.js"></script>
		<script>
			class CalculatorComponent {
				constructor(list_of_types, funcs, title) {
					this.types = list_of_types;
					this.idPrefix = Math.random().toString(36).substring(2);
					this.funcs = funcs;
					this.title = "<h3>" + title + "</h3>\n<p>" + this.types.join(" &#8596; ") + "</p>";
				}

				mount() {
					var self = this;
					var html = '<div class="calc">' + this.title;
					for (var i in this.types) {
						var elemId = this.idPrefix + i;
						html += '<div><input type="text" class="' + this.idPrefix + '" id="' + elemId + '"> ' + this.types[i] + "</div>";
						(function() {
							var k = i;
							$("#content").on("input", "#" + elemId, function() {
								var myValue = this.value;
								var funcs = self.funcs[k];
								var fi = 0;
								var inputElems = $("." + self.idPrefix);
								for (var m = 0; m < inputElems.length; m++) {
									if (inputElems[m].id != self.idPrefix + k) {
										var convertedValue = funcs[fi](myValue);
										$("body").find("#" + inputElems[m].id).val(convertedValue);
										fi += 1;
									}
								}
							});
						})(); //must call to preserve frame
					}
					html += "</div>"
					$("#content").append(html);
				}
			}

			var usign = new CalculatorComponent(["Hex", "Binary (unsigned)", "Decimal"], [
				[hex_to_binary, function(hex) { return binary_to_decimal(hex_to_binary(hex)); }],
				[binary_to_hex, binary_to_decimal],
				[function(decimal) { return binary_to_hex(decimal_to_binary_unsigned(decimal)); }, decimal_to_binary_unsigned],
			], "Unsigned Number Representation");
			usign.mount()

			var twos = new CalculatorComponent(["Hex", "Binary (Two's Complement)", "Decimal"], [
				[function(hex) {
					if (hex == "") {
						return ""
					}
					var binary_rep = hex_to_binary(hex);
					if (binary_rep == "") {
						return ""
					}
					if (binary_rep.length > 8) {
						binary_rep = least_sig(binary_rep, 8);
					} else {
						binary_rep = "0".repeat(8 - binary_rep.length) + binary_rep;
					}
					return binary_rep; 
				}, function(hex) {
					if (hex == "") {
						return ""
					}
					var binary_rep = hex_to_binary(hex);
					if (binary_rep == "") {
						return ""
					}
					if (binary_rep.length > 8) {
						binary_rep = least_sig(binary_rep, 8);
					} else {
						binary_rep = "0".repeat(8 - binary_rep.length) + binary_rep;
					}
					return twos_to_decimal(binary_rep, 8); 
				}],
				[binary_to_hex, function(binary) { return twos_to_decimal(binary, 8); }],
				[function(decimal) { return binary_to_hex(decimal_to_twos(decimal, 8)); }, function(decimal) { return decimal_to_twos(decimal, 8) }],
			], "8-bit Two's Complement Number Representation");
			twos.mount()
		</script>
	</body>
</html>
